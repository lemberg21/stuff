---
- name: Create a windows vm from template vm
  hosts: "{{ lookup('env','HOSTS') }}"
  gather_facts: false
  collections:
    - community.vmware
  tasks:
    - name: Instant clone a VM with quest_customization
      vmware_guest:
        hostname: "{{ lookup('env','vcenter_hostname') }}"
        username: "{{ lookup('env','vcenter_username') }}"
        password: "{{ lookup('env','vcenter_password') }}"
        folder: "{{ lookup('env','folder') }}"
        datacenter: "{{ lookup('env','datacenter') }}"
        cluster: "{{ cluster }}"
        template:  "{{ lookup('env','template') }}"
        name:  "{{ lookup('env','vm_hostname') }}"
        disk:
           - size_gb: "{{ disk_size }}"
             type: "thin"
             autoselect_datastore: yes
        hardware:
          memory_mb: "{{ memory_mb }}"
          num_cpus: "{{ num_cpus }}"
        networks:
          - name: "{{ vlan_name }}"
            memory_mb: "{{ memory_mb }}"
            num_cpus: "{{ num_cpus }}"
          
